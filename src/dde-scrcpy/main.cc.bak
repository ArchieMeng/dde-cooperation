#include <DApplication>

#include "ui/MainWindow.h"
#include "ui/VideoForm.h"
#include "QtScrcpyCore.h"

DWIDGET_USE_NAMESPACE

int main(int argc, char *argv[]) {
    DApplication app(argc, argv);
    app.setOrganizationName("deepin");
    app.setApplicationName("dde-scrcpy");

    MainWindow w;

    qsc::DeviceParams params;
    qsc::IDevice *device = qsc::IDevice::create(params, &w);
    // device->startListen();

    QObject::connect(device,
                     &qsc::IDevice::deviceConnected,
                     [&w, device](bool success,
                                  const QString &serial,
                                  const QString &deviceName,
                                  const QSize &size) {
                         w.hide();

                         VideoForm *videoForm = new VideoForm(device, &w);
                         device->setParent(videoForm);
                         videoForm->show();
                     });

    w.show();

    return app.exec();
}
